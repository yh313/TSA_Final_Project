---
title: "Untitled"
author: "Yu Hai"
date: "2022/3/31"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
library(readxl)
library(lubridate)
library(ggplot2)
library(forecast)  
library(Kendall)
library(tseries)
library(outliers)
library(tidyverse)
library(smooth)
library(zoo)
library(kableExtra)
```

```{r}
US_NG<-read.csv(file="./Data/Henry_Hub_Natural_Gas_Spot_Price.csv", skip=4)
US_NG
```
```{r}
US_NG$month <- substring(US_NG$Month,1,3)
US_NG$year <- substring(US_NG$Month,4,)
```


```{r}
US_NG$Month<-my(paste0(US_NG$month,"-",US_NG$year))
head(US_NG)
US_NG<-US_NG[order(as.Date(US_NG$Month, format="%Y/%m/%d")),]
US_NG<-US_NG%>%
  rename( HHNG.Price=Henry.Hub.Natural.Gas.Spot.Price.Dollars.per.Million.Btu ) 
tail(US_NG)
```

```{r}
ts_US_NG <- ts(US_NG$HHNG.Price,frequency=12,start=c(1997,01), end=c(2022,02))
plot(ts_US_NG)
```
```{r}
n_for=12
ts_US_NG_train<-subset(ts_US_NG,end=length(ts_US_NG)-n_for)
ts_US_NG_test<-subset(ts_US_NG,start=length(ts_US_NG)-n_for)
ts_US_NG_train %>% mstl() %>%
autoplot()
```

```{r}
EU_price<-read.csv(file="./Data/World_NG_Price.csv")
EU_price$DATE<-as.Date(EU_price$DATE)
EU_price
```

```{r}
EU_price<-EU_price%>%
  rename( Price=PNGASEUUSDM ) 
tail(EU_price)
```
```{r}
ts_EU_price <- ts(EU_price$Price,frequency=12,start=c(1990,01), end=c(2022,03))
plot(ts_EU_price)
```
```{r}
ts_EU_price %>% mstl() %>%
autoplot()
```

```{r}
n_for=12
ts_EU_price_train<-subset(ts_EU_price,end=length(ts_EU_price)-n_for)
ts_EU_price_test<-subset(ts_EU_price,start=length(ts_EU_price)-n_for)
ts_EU_price_train %>% mstl() %>%
autoplot()
```
```{r}
SARIMA_autofit <- auto.arima(ts_EU_price_train)
checkresiduals(SARIMA_autofit)
```


